note:
    僕は結構社内の中でもマイナーな人間で、あんまし知らない人もいて、あいつ生意気そうやけど何やってる>んかなーって人も多いと思います。のでちょっとだけ自己紹介させてください。
    どうも嵐 順平ともうします。
    っで、2012年に入社して、そのときはNBUっていう組織があってそこでインフラエンジニアしてました。
    っで、2013年くらいにNBUがAmebaとがっちゃんこするってことで、Ameba所属になりました。
    ほんでもって、今年の5月からアドテク事業部配属になりました。アドテク事業部ではDynalystのインフラエンジニアとして働くことになって、今はDynalystとSSPのインフラエンジニアを兼務させてもらってます。

note:
    本日のアジェンダです。
    CloudWatch Logs Agentとはなんぞやって話と
    AWS以外のSAAS。これはbackendにAWSを使ってるのでスポンサーとしていろんなサービスが来てたんですが、その中でいくつか気になったものをご紹介的な
    個人的によかったなというセッション
    こんな感じで行こうかと思います。
    話してる途中でも質問とかあったらどんどん聞いてくださいまし。

note:
    1. ログをCloudWatchに送信します
    で前提知識としてですがCloudWatchはAWSの監視サービスでCPU使用率とかインスタンスレベルの低レイヤー>なものから
    ELBのstatus codeみたいなL7レイヤーのメトリックまでいろんなものが取得、グラフ化されていて、そこに>アラートを設定できたりします
    2. ログのフィルタリングができます
    各レコードに特定の文字列が入っていたらとか、status codeが4XX系だけでグラフにするとかそんなことが>できます
    3. フィルタリングができるってことはアラートも設定できて、たとえばerrorっていう文字列が出たらとか>、
    5xxエラーが一定数以上でたらメール飛ばすみたいなことが可能です
    4. でも残念なことに1行が1レコードなので、JavaのExceptionをparseしたいんだがみたいな用途には使えないです...
    5. さぁ、これでFluentdとおさらばしましょう


でもお高いんでしょう??
僕なりに金額を試算してみました。
料金は0.5$ per 1GBです。これだけ見ると高いようにも思うんですが、
1日に1GBのlogを吐き出すサーバが10台いるとして30日で0.5$===

150$!!です。


っでこれをEC2(ElasticSearch+Kibanaでやる前提)と比較すると、こんなにも価格が違います。
ちなみに,3.xlargeは4コア15GBのメモリでまぁそこそこのインスタンスってかんじですが、ElasticSearchのクエリのキャッシュを置くためには15GBでは少し少ない感じもします。

以上がLogs Agentです。

----------

次は、AWS以外のSaaSでよさげだったものを紹介したいです。
LogglyとDatadogです。

<aside class="notes">
    何をもって世界でもっともポピュラーなのかはわからないですが、まぁポピュラーらしいです。
    AWSパートナーがブースを出して自社サービスの説明とかやってて、logglyの人に聞いてみたんですが、
    Exceptionをかたまりで解釈できるそうで、どんなExceptionがどれくらいでてるかってのがわかるそうです>。
    ここが、Logs Agentとは違うおっきな点かなと思いました。ちなみに裏側はElasticSearchだそうです。
</aside>

メリットとして大きいのは、Java(というかどんな言語に限らずですが)のExceptionをparseできるところです。っでどんなExceptionが時間あたりにどれくらい出たかを算出できます。なので、このExceptionが出たらアラートするってのがスマートに出来てすばらしいですね。

しかし、デメリットとしてはアメリカにしかサーバがないぽくてダッシュボードが結構もっさりしてます。。。。

----------

っでおつぎが、Datadog
このサービスはMonitoring as a Serviceなんですが、一般的なCPU使用率とかメモリとかだけじゃなくて各種ミドルウェアの実装もされてて、結構いろんなものが取れる感じです。
中でもgithubインプリメンテーションがいい感じで、githubのcommitを時系列で追ってくれるので、サーバのmetricと照らしあわせて、どの(あるいは誰の)commitでサービスが重くなったことができるんじゃないかと考えています。

    んで、いいところは、EC2のtagでサーバ一覧のダッシュボードが作れるところで、サーバ一台一台が忙しいみたいなミクロな視点で
    監視をするんじゃなくて、全体でどれくらい忙しい的なマクロな視点で監視をしようとしているところも今風でよかったなと。

あと、Datadog側にホストの定義が必要ないってのも重要で、serverがimmutableな場合、server側からpushする形で監視が追加できるのはすごいメリットだなと。



っで、これが実際に入れてみた感じです。
これは僕の今スライドを表示してるPCなんですが、こんな感じで(やるやる)いろんな値が見れたりします。
あと、チャットがweb UIにくっついてるので、この障害どうする的なやりとりのlogが残せるのもでかいかなと思います。

今のところ、これといってデメリットは思いつかず。。。ちょっと本番環境でつかえたらいいなーと思ってます。

----------

note:
    Day 2 Keynote とにかくECSのdemoがかっこよかったので、ぜひ見てください
    Lightning Fast Deploys ry Dockerの中の人のsessionで、docker commandをシェルスクリプトでラップしてるんですが、
        この人の遊びみたいなsessionで、とてもfunnyなsessionでした
    Amazon EC2 Container Service 今のところ、ECSが今後どういうサポートをしていくのか(ELB Integrationとか)をしゃべってるところは、
        調べたところ、これだけでした。コンテナ間の通信(どのポートをserver側のlistenポートとしてあけるかとか)の定義とかもしてて、
        オーケストレーション、って感じのsessionでした
    Monitoring and Runnig ry Datadogの広告みたいなとこもあったんですが、Immutableなserverを運用してると、事前にホストの定義とかが
        必要な監視システムが崩壊するので、DatadogのEC2ホストとEC2上のContainerを勝手に監視してくれるってのは魅力的でした
    How Netflix' Open Source Tools Help Accelerate ry
        Netflixが自分たちで作って自分たちで使ってるOSSを紹介してるsessionで、正直全部が全部使えるかって言われるとそんなことはないんですが
        Security MonkeyっていうSecurity Holeを探してくれたり、AWSのLimitationを通知してくれるシステムがよさげでした
    Optimizing Your Web Server on AWS
        Web Serverのチューニングについてのsessionで、今一度KeepAliveについて考えたり、NginxやApacheのconfigに合わせた
        kernel parameterを紹介してくれてました
        あと、このセッションでログは嘘をつかないみたいな話があるんですが、なんとなくログを眺めるんじゃなくて、
        どのURIが重いかとか、HTTP Method単位で見ろとか、ちゃんとログの中身を理解した監視をしましょうって話でした


----------

今日はサプライズを用意してきました。
突然ですが、このAWSのTシャツ欲しい人ー??
っぽい

ありがとうございました！！
